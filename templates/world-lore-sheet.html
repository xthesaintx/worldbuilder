<div class="campaign-codex world-lore">
  
  {{!-- Header --}}
  <header class="lore-header">
    <div class="lore-title">
      <h1><i class="fas fa-globe"></i> {{document.name}}</h1>
      <div class="category-selector">
        <label>Category:</label>
        <select name="category" class="category-dropdown">
          {{#each categories}}
            <option value="{{this}}" {{#eq this ../loreData.category}}selected{{/eq}}>{{this}}</option>
          {{/each}}
        </select>
      </div>
    </div>
  </header>

  <div class="content-wrapper">
    {{!-- Side Navigation --}}
    <nav class="side-tabs">
      <a class="tab-item active" data-tab="content" title="Content">
        <i class="fas fa-scroll"></i>
        <span>Content</span>
      </a>
      <a class="tab-item" data-tab="connections" title="Connections">
        <i class="fas fa-link"></i>
        <span>Connections</span>
      </a>
      <a class="tab-item" data-tab="organization" title="Organization">
        <i class="fas fa-tags"></i>
        <span>Organization</span>
      </a>
      {{#if isGM}}
        <a class="tab-item" data-tab="gmnotes" title="GM Notes">
          <i class="fas fa-eye-slash"></i>
          <span>GM Notes</span>
        </a>
      {{/if}}
    </nav>

    {{!-- Content Area --}}
    <main class="tab-content">
      
      {{!-- Content Tab --}}
      <section class="tab-panel active" data-tab="content">
        <div class="panel-header">
          <h2><i class="fas fa-scroll"></i> Lore Content</h2>
        </div>
        
        <form class="content-form">
          <div class="form-section">
            <label class="form-label">
              <i class="fas fa-feather-alt"></i>
              Main Content
            </label>
            <textarea name="content" class="form-textarea large" rows="12" placeholder="Enter the lore content here...">{{loreData.content}}</textarea>
          </div>
          
          <div class="form-section">
            <div class="checkbox-card">
              <label class="checkbox-label">
                <input type="checkbox" name="playerVisible" {{#if loreData.playerVisible}}checked{{/if}}>
                <span class="checkmark"></span>
                <i class="fas fa-eye"></i>
                <span class="label-text">Visible to Players</span>
              </label>
              <p class="help-text">Uncheck to keep this lore GM-only</p>
            </div>
          </div>
        </form>
      </section>

      {{!-- Connections Tab --}}
      <section class="tab-panel" data-tab="connections">
        <div class="panel-header">
          <h2><i class="fas fa-link"></i> Connections</h2>
          <button type="button" class="header-btn search-link">
            <i class="fas fa-search"></i>
            Search & Link
          </button>
        </div>
        
        <div class="drop-zone compact" data-drop-type="any">
          <i class="fas fa-link"></i>
          <span>Drag journals or NPCs here to create connections</span>
        </div>
        
        {{#if linkedEntries}}
          <div class="connections-grid">
            {{#each linkedEntries}}
              <div class="connection-card">
                <div class="connection-icon">
                  {{#eq type "journal"}}
                    <i class="fas fa-book"></i>
                  {{else}}
                    <i class="fas fa-user"></i>
                  {{/eq}}
                </div>
                <div class="connection-info">
                  <h4 class="connection-name">{{document.name}}</h4>
                  <span class="connection-type">{{type}}</span>
                  {{#if description}}
                    <p class="connection-desc">{{description}}</p>
                  {{/if}}
                </div>
                <div class="connection-actions">
                  <button type="button" class="action-btn open-document" data-document-id="{{document.id}}" data-document-type="{{type}}" title="Open">
                    <i class="fas fa-external-link-alt"></i>
                  </button>
                  <button type="button" class="action-btn delete-link" data-link-id="{{linkId}}" title="Remove">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </div>
            {{/each}}
          </div>
        {{else}}
          <div class="empty-state">
            <i class="fas fa-link"></i>
            <h3>No Connections</h3>
            <p>Drag documents here to create connections</p>
          </div>
        {{/if}}
      </section>

      {{!-- Organization Tab --}}
      <section class="tab-panel" data-tab="organization">
        <div class="panel-header">
          <h2><i class="fas fa-tags"></i> Organization</h2>
          <button type="button" class="header-btn add-tag">
            <i class="fas fa-plus"></i>
            Add Tag
          </button>
        </div>
        
        {{#if loreData.tags}}
          <div class="tags-container">
            <h3>Tags</h3>
            <div class="tags-list">
              {{#each loreData.tags}}
                <span class="tag-chip">
                  <span class="tag-text">{{this}}</span>
                  <button type="button" class="tag-remove remove-tag" data-tag="{{this}}">
                    <i class="fas fa-times"></i>
                  </button>
                </span>
              {{/each}}
            </div>
          </div>
        {{else}}
          <div class="empty-state">
            <i class="fas fa-tags"></i>
            <h3>No Tags</h3>
            <p>Tags help organize and search your lore entries</p>
          </div>
        {{/if}}
        
        <div class="category-card">
          <div class="category-header">
            <h3><i class="fas fa-folder"></i> Category: {{loreData.category}}</h3>
          </div>
          <p class="category-description">
            {{#eq loreData.category "Geography"}}
              Information about places, regions, landmarks, and physical locations.
            {{else}}{{#eq loreData.category "History"}}
              Historical events, timelines, and past occurrences that shape the world.
            {{else}}{{#eq loreData.category "Organizations"}}
              Guilds, factions, governments, religions, and other organized groups.
            {{else}}{{#eq loreData.category "Culture"}}
              Languages, customs, traditions, holidays, and cultural practices.
            {{else}}{{#eq loreData.category "Magic & Mysteries"}}
              Magical phenomena, ancient artifacts, unexplained mysteries.
            {{else}}{{#eq loreData.category "Pantheon"}}
              Gods, deities, divine domains, and religious information.
            {{else}}
              General world lore and miscellaneous information.
            {{/eq}}{{/eq}}{{/eq}}{{/eq}}{{/eq}}{{/eq}}
          </p>
        </div>
      </section>

      {{!-- GM Notes Tab --}}
      {{#if isGM}}
        <section class="tab-panel" data-tab="gmnotes">
          <div class="panel-header">
            <h2><i class="fas fa-user-secret"></i> GM Notes</h2>
          </div>
          
          <form class="content-form">
            <div class="form-section">
              <label class="form-label gm-only">
                <i class="fas fa-eye-slash"></i>
                Private GM Notes
              </label>
              <textarea name="gmNotes" class="form-textarea large" rows="10" placeholder="Private GM notes, secret information, future plot developments...">{{loreData.gmNotes}}</textarea>
            </div>
          </form>
          
          <div class="gm-tools">
            <h3><i class="fas fa-tools"></i> GM Tools</h3>
            <div class="tool-grid">
              <button type="button" class="tool-btn create-handout">
                <i class="fas fa-file-alt"></i>
                <span>Create Player Handout</span>
              </button>
              <button type="button" class="tool-btn duplicate-entry">
                <i class="fas fa-copy"></i>
                <span>Duplicate Entry</span>
              </button>
            </div>
          </div>
        </section>
      {{/if}}
      
    </main>
  </div>

  {{!-- Footer --}}
  <footer class="sheet-footer">
    <button type="button" class="save-btn save-lore-data">
      <i class="fas fa-save"></i>
      Save Changes
    </button>
  </footer>

</div>